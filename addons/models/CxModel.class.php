<?php/** * 诚信度模型 * * @author nonant */class CxModel extends Model {    protected $tableName = 'event_cx';    public function getCxDb($uid){        $cx = $this->where('uid='.$uid)->find();        if(!$cx){            return array('total'=>0,'attend'=>0,'absent'=>0,'status'=>0,'sday'=>'0000-00-00','eday'=>'0000-00-00','grad'=>'暂无');        }else{            $cx['grad'] = ceil($cx['attend']*100/$cx['total']).'%';        }        return $cx;    }    public function getCxCache($uid){        $userInfo = S('S_userInfo_'.$uid);        if(empty($userInfo)) {            return $this->getCxDb($uid);        }        $userInfo['cx'] = $this->getCxDb($uid);        S('S_userInfo_'.$uid, $userInfo);        if(isset($_SESSION['userInfo']) && $_SESSION['mid'] == $uid){            $_SESSION['userInfo']['cx'] = $userInfo['cx'];        }        return $userInfo['cx'];    }}